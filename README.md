# 高中历史智能出题系统

基于《普通高中历史课程标准（2017年版2025年修订）》的智能出题系统，使用 RAGFlow API 自动生成高质量历史题目。

## 📚 快速导航

- **[🚀 快速开始](./QuickStart.md)** - 10 分钟快速上手指南
- **[📦 RAGFlow 安装教程](./RAGFlow安装教程.md)** - 详细的 RAGFlow 安装与配置指南
- **[📖 完整文档](#)** - 本文档包含项目详细说明

## 项目简介

本系统是一个专门为高中历史教学设计的智能出题工具，能够根据课程标准自动生成符合要求的历史试题。系统通过 RAGFlow 的知识库检索能力，结合精心设计的提示词工程，生成既符合课标要求又具有思维深度的历史题目。

## 核心功能

- **多模块支持**：覆盖必修课程（中外历史纲要上下册）和三本选择性必修教材
- **多题型生成**：支持单项选择题、材料分析题等多种题型
- **素养导向**：严格对照五大核心素养（唯物史观、时空观念、史料实证、历史解释、家国情怀）
- **难度分级**：可选择不同难度等级的题目
- **史料类型**：支持文字材料、图片、表格、地图等多种史料形式
- **智能解析**：自动生成详细的答案解析和知识迁移说明

## 项目结构

```
history_agent/
├── app.py                  # Streamlit 前端界面
├── backend.py              # FastAPI 后端服务
├── main.py                 # 项目入口文件
├── curriculum_data.json    # 课程标准配置数据
├── books/                  # 教材 PDF 文件
│   ├── 《中外历史纲要》（上）课程正文.pdf
│   ├── 《中外历史纲要》（下）课程正文.pdf
│   ├── 选择性必修1：国家制度与社会治理.pdf
│   ├── 选择性必修2：经济与社会生活.pdf
│   └── 选择性必修3：文化交流与传播.pdf
├── pyproject.toml          # 项目依赖配置
└── README.md               # 项目文档
```

## 技术栈

- **前端**：Streamlit - 快速构建交互式 Web 界面
- **后端**：FastAPI - 高性能 API 服务
- **AI 引擎**：RAGFlow - 基于知识库的智能问答
- **Python 版本**：>= 3.12

## 依赖项

```toml
fastapi>=0.128.0
requests>=2.32.5
streamlit>=1.52.2
uvicorn>=0.40.0
```

## 安装与配置

> 💡 **新手推荐**：如果您是第一次使用，强烈建议先阅读 [快速开始指南](./QuickStart.md)，它提供了更详细的步骤说明。

### 1. 环境准备

确保已安装 Python 3.12 或更高版本，以及 uv 包管理器。

```bash
# 安装依赖
uv sync
```

### 2. 安装和配置 RAGFlow

**重要**：在使用本系统之前，您需要先安装和配置 RAGFlow。详细步骤请参考：

👉 **[RAGFlow 安装教程](./RAGFlow安装教程.md)**

该教程包含：
- RAGFlow 的完整安装步骤（Docker 方式）
- 知识库创建和文档上传
- 对话助手配置
- API Key 和 Chat ID 获取方法

### 3. 配置项目连接

在 `backend.py` 中修改以下配置：

```python
# RAGFlow 服务器地址
RAGFLOW_HOST = "http://localhost:80"

# RAGFlow API Key
RAGFLOW_API_KEY = "your-api-key-here"

# Chat ID（对话助手 ID）
CHAT_ID = "your-chat-id-here"
```

**重要提示**：
- `RAGFLOW_HOST`：RAGFlow 服务的访问地址
- `RAGFLOW_API_KEY`：在 RAGFlow 后台获取的 API 密钥（参考安装教程）
- `CHAT_ID`：在 RAGFlow 后台创建的对话助手 ID（参考安装教程）

### 4. 准备知识库

将 `books/` 目录下的教材 PDF 上传到 RAGFlow 知识库，确保系统能够检索到相关教材内容。

详细步骤请参考 [RAGFlow 安装教程](./RAGFlow安装教程.md) 中的"上传教材 PDF"章节。

## 使用方法

### 启动后端服务

```bash
uvicorn backend:app --reload --port 8000
```

后端服务将在 `http://127.0.0.1:8000` 启动。

### 启动前端界面

```bash
streamlit run app.py
```

前端界面将在浏览器自动打开（默认 `http://localhost:8501`）。

### 出题流程

1. **选择教材模块**：从必修或选择性必修中选择
2. **选择考察专题**：根据模块选择具体专题
3. **选择题目类型**：单项选择题或材料分析题等
4. **选择核心素养**：可多选，至少选择一项
5. **设置难度等级**：根据需求选择合适难度
6. **选择史料类型**：文字、图片、表格或地图
7. **点击"开始出题"**：系统将自动生成题目

## 核心素养说明

系统严格遵循课程标准的五大核心素养：

### 1. 唯物史观（理论指导）
考察生产力与生产关系、经济基础与上层建筑的互动关系。

### 2. 时空观念（学科本质）
包含明确的时间尺度和空间位置，考察历史变化和阶段特征。

### 3. 史料实证（必备技能）
引用一手史料，要求学生进行史料辨析和信息提取。

### 4. 历史解释（能力要求）
不仅问"是什么"，更要问"为什么"和"怎么看"。

### 5. 家国情怀（价值追求）
选取具有感染力的历史人物或民族危亡/复兴的关键时刻。

## 出题策略

系统采用高级提示词工程，包含：

- **思维链（Step-by-Step Thinking）**：引导 AI 按照专业命题逻辑思考
- **负面约束（Negative Constraints）**：严禁死记硬背、直接抄录教材等
- **素养规则注入**：根据选中的素养自动注入对应的出题策略
- **JSON 格式控制**：确保输出结构化、易解析的题目数据

## API 接口

### POST /generate_question

生成历史题目的核心接口。

**请求体**：
```json
{
  "topic": "1.7 晚清时期的内忧外患与救亡图存",
  "competencies": ["spacetime", "evidence"],
  "difficulty": "medium",
  "material_type": "text",
  "question_type": "choice"
}
```

**响应**：
```json
{
  "status": "success",
  "data": {
    "material": "史料内容...",
    "question_body": "题干内容...",
    "options": {
      "A": "选项A",
      "B": "选项B",
      "C": "选项C",
      "D": "选项D"
    },
    "answer": "C",
    "analysis": "解析内容...",
    "type": "choice"
  }
}
```

## 教材模块

### 必修课程
- **中外历史纲要（上）**：中国通史，15个专题
- **中外历史纲要（下）**：世界通史，10个专题

### 选择性必修
- **选择性必修1**：国家制度与社会治理（6个专题）
- **选择性必修2**：经济与社会生活（6个专题）
- **选择性必修3**：文化交流与传播（7个专题）

## 注意事项

1. **配置检查**：首次使用前务必正确配置 `backend.py` 中的 RAGFlow 相关参数
2. **知识库准备**：确保 RAGFlow 知识库已上传并索引了教材 PDF
3. **网络连接**：确保能正常访问 RAGFlow 服务
4. **超时设置**：当前 API 超时时间设置为 120 秒，生成复杂题目时可能需要等待
5. **JSON 解析**：如果遇到 JSON 解析错误，可在 RAGFlow 助手的 System Prompt 中强调"只输出 JSON"

## 故障排查

### 404 错误
检查 `CHAT_ID` 是否填写正确，以及 RAGFlow 地址是否正确。

### JSON 解析失败
在 RAGFlow 助手的 System Prompt 中添加：
```
你必须严格按照 JSON 格式输出，不要包含任何其他文字或 Markdown 标记。
```

### 连接超时
- 检查 RAGFlow 服务是否正常运行
- 检查网络连接是否正常
- 尝试增加 `timeout` 参数值

## 开发计划

- [ ] 支持更多题型（判断题、简答题等）
- [ ] 添加题目导出功能（PDF、Word）
- [ ] 实现题目收藏和管理
- [ ] 添加用户反馈和题目质量评分
- [ ] 支持批量出题功能

## 许可证

本项目仅供教学研究使用。

## 贡献

欢迎提交 Issue 和 Pull Request。
